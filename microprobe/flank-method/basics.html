<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Basics – mag4</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"express",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":"",
"website_privacy_policy_url":"https://hezel2000.github.io/mag4/about.html"
  ,
"language":"en"
  });
});
</script> 
  
<link rel="stylesheet" href="gdpr/cookieconsent-3.0.1/cookieconsent.css" media="print" onload="this.media='all'">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">mag4</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../microprobe/epma-intro.html" aria-current="page"> 
<span class="menu-text">Microprobe</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../sem/sem-intro.html"> 
<span class="menu-text">SEM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../mu_xrf/mu_xrf-intro.html"> 
<span class="menu-text">µ.XRF</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../periphery/periphery-intro.html"> 
<span class="menu-text">Periphery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../mass-spec/mass-spec-intro.html"> 
<span class="menu-text">Mass Spectrometry</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resources/resources-intro.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-courses" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Courses</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-courses">    
        <li>
    <a class="dropdown-item" href="../../courses/data_science.html">
 <span class="dropdown-text">Data Science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hezel2000.quarto.pub/dmg-data-science-short-course">
 <span class="dropdown-text">Data Science Short Course</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../courses/cosmochemistry.html">
 <span class="dropdown-text">Kosmochemie</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hezel2000.quarto.pub/mikroanalytik/">
 <span class="dropdown-text">Mikroanalytik</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hezel2000.quarto.pub/geochemie-1/">
 <span class="dropdown-text">Geochemie I - Kosmochemie-Teil</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://hezel2000.quarto.pub/umweltwissenschaften-mikroanalytik/">
 <span class="dropdown-text">Umweltwissenschaften - Mikroanalytik-Teil</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../allapps/allapps.html"> 
<span class="menu-text">All Apps</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../microprobe/flank-method/welcome.html">Flank Method</a></li><li class="breadcrumb-item"><a href="../../microprobe/flank-method/basics.html">Basics</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/epma-intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EPMA Lab</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Measurements</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/data-access/request-time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Requesting Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/data-access/access-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Accessing Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/data-access/kadi4mat-backend-eln.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kadi4Mat backend ELN</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Flank Method</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/welcome.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/basics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Basics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/data-reduction-program.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Reduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/video-tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Video Tutorials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/publications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Publications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/code.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Data Reduction Code</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/flank-method/glossary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Glossary</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/epma-tutorials/epma-tutorials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tutorials</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/trouble-shooting/trouble-shooting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Trouble Shooting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../microprobe/tools/resources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Apps</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#principle" id="toc-principle" class="nav-link" data-scroll-target="#principle">Principle</a></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application">Application</a></li>
  <li><a href="#parametrisation" id="toc-parametrisation" class="nav-link" data-scroll-target="#parametrisation">Parametrisation</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#alternatives" id="toc-alternatives" class="nav-link" data-scroll-target="#alternatives">Alternatives</a></li>
  <li><a href="#determining-analyser-crystal-positions" id="toc-determining-analyser-crystal-positions" class="nav-link" data-scroll-target="#determining-analyser-crystal-positions">Determining Analyser Crystal Positions</a></li>
  <li><a href="#epma-set-up" id="toc-epma-set-up" class="nav-link" data-scroll-target="#epma-set-up">EPMA Set-Up</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../microprobe/flank-method/welcome.html">Flank Method</a></li><li class="breadcrumb-item"><a href="../../microprobe/flank-method/basics.html">Basics</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Basics</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The members of the garnet group have a large variety of chemical compositions with the general formula A<sup>2+</sup><sub>3</sub>B<sup>3+</sup><sub>2</sub>(SiO<sub>4</sub>)<sub>3</sub>. A is a distorted octahedral site and B a normal octahedral site. Here we focus on the two garnets almandine and andradite, which differ in their chemical composition and the valence state of Fe. Almandine has the chemical formula Fe<sup>2+</sup><sub>3</sub>Al<sub>2</sub>(SiO<sub>4</sub>)<sub>3</sub>, with Fe as Fe<sup>2+</sup> in the distorted octahedral A site, and andradite has the chemical formula Ca<sub>3</sub>Fe<sup>3+</sup><sub>2</sub>(SiO<sub>4</sub>)<sub>3</sub>, with Fe as Fe<sup>3+</sup> in the octahedral B site. There is a general, large immiscibility gap between almandine and andradite, however, almandine can have up to ~10% Fe<sup>3+</sup> and andradite up to ~10% Fe<sup>2+</sup>. This amount is expressed in the atomic ratio Fe<sup>3+</sup>/FeT, with FeT meaning total Fe. The amount of Fe<sup>3+</sup>/FeT can be directly used to calculate the amount of free oxygen, i.e., the oxygen fugacity (<span class="math inline">\(\rightarrow\)</span> fO<sub>2</sub>) while the garnet formed.</p>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Almandine: Fe<sup>2+</sup><sub>3</sub>Al<sub>2</sub>(SiO<sub>4</sub>)<sub>3</sub>, up to ~10% Fe<sup>3+</sup>/FeT<br>
Andradite: Ca<sub>3</sub>Fe<sup>3+</sup><sub>2</sub>(SiO<sub>4</sub>)<sub>3</sub>, down to ~90% Fe<sup>3+</sup>/FeT<br>
The amount of Fe<sup>3+</sup>/FeT is used to calculate the fO<sub>2</sub>.</p>
</div>
</div>
</div>
</section>
<section id="principle" class="level1">
<h1>Principle</h1>
<p>The energies of the FeL<span class="math inline">\(\alpha\)</span> and FeL<span class="math inline">\(\beta\)</span> lines are close together at 0.7049 and 0.7183 keV, respectively. These energies translate to analyser crystal positions, i.e., L-values on a JEOL microprobe of 191.218 and 187.631 mm. The relative intensities of the lines are 80 and 20, respectively, on a normalised scale of 100. <a href="#fig-fe-spectra-alm" class="quarto-xref">Figure&nbsp;1</a> shows the FeLa and FeLb peaks of an almandine spectra. The vertical lines indicate the tabulated values for FeLa and FeLb. A single tabulated and measured values need not to coincide, as this depends on the mechanical build. The distance of FeLa and FeLb, on the other, should be the same between the tabulated and measured peaks. However, this is not the case as already visible in <a href="#fig-fe-spectra-alm" class="quarto-xref">Figure&nbsp;1</a> by the naked eye.</p>
<div id="fig-fe-spectra-alm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe-spectra-alm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-spectra-alm.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe-spectra-alm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: An Almandine Fe spectra with the Fe La and Lb lines. Taken with 2 µm steps, 1 s dwell time, 3 accumulations at 100 nA and 15 kV in Diff mode to suppress the FeKa 9. order peak at 189.417 mm (0.7116 keV). Spectra obtained with the GU Frankfurt IfG JEOL EPMA.
</figcaption>
</figure>
</div>
<p>This means, at least one peak is not where it theoretically should be. The reason is the crystal field in which an atom, in this case the Fe atom, sits. This crystal fields slightly changes the electron energy levels around the Fe atom, and therewith the differences between the electron energy levels. <a href="#fig-fe-energy-levels" class="quarto-xref">Figure&nbsp;2</a> illustrates this effect. The lengths of the arrows represent the energy differences when an electron from a higher shell transitions down to a lower shell, thereby emitting the characteristic X-rays with the same energies as these energy difference. The comparison of the arrow lengths on the right illustrate the change in energy difference between the two characteristic lines La and Lb.</p>
<div id="fig-fe-energy-levels" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe-energy-levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-energy-levels.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe-energy-levels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Schematic comparison of tabulated Fe energy levels with energy levels that are slightly changed by the crystal field.
</figcaption>
</figure>
</div>
<p>These differences define the energies of the characteristic X-rays of the Lb and La lines. This effect is called <em>chemical peak shift</em>, and is the fundamental effect, upon which the flank method builds. :red[And finally, this effect also changes the relative intensities of the Lb and La lines.]</p>
<p>Now, the Fe<sup>2+</sup> in pure almandine occupies the distorted octahedral site, while the Fe<sup>3+</sup> in pure andradite occupies the normal octahedral site. These two different crystal fields result in slightly different energy levels, and therewith in different energies of the characteristic La and Lb lines and different peak intensities. Hence, almandine and andradite are discriminated by the location and height of their La and Lb peaks. The goal is, however, not to simply discriminate two minerals, Further, most garnets in mantle and metamorphic rocks are solid solutions between almandine and pyrope with the general formula (Mg,Fe)<sub>3</sub>Al<sub>2</sub>(SiO<sub>4</sub>)<sub>3</sub>. These garnets contain, as outlined above, small amounts of Fe<sup>3+</sup>, which is a function of the ambient fO<sub>2</sub> during garnet formation. But even small variations of Fe<sup>3+</sup> shift the positions and increase/decrease the intensities of the La and Lb peaks. We cannot sensibly quantify an entire spectrum such as the one shown in <a href="#fig-fe-spectra-alm" class="quarto-xref">Figure&nbsp;1</a>, and obtaining such spectra would cost way too much time. We therefore position the analyser crystal at a certain L-value, and measure the counts at this position in a standard and then in the sample. Because the peak shifted and in- or decreased its intensity depending on the sample’s Fe<sup>3+</sup>/FeT ratio, the counts in the sample will be either lower or higher than in the standard. As these count differences will be small, it is important to move the analyser crystal to a position with maximum count differences between standard and sample. As is seen from the schematic <a href="#fig-flank-pos-determination" class="quarto-xref">Figure&nbsp;3</a>, this position is at around the middle of a peak’s flank (now guess how this method earned its name). Each measurement position results in another count difference between the standard and sample peak. Note that <em>peak</em> means <em>somewhere</em> on the peak, not the peak maximum – which would not possible for both peaks at the same time when the measurement position is fixed, but the peak maximum of the samples is shifted from the peak maximum of the standard.</p>
<div id="fig-flank-pos-determination" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-flank-pos-determination-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/flank-pos-determination.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-flank-pos-determination-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Schematic FeL peak in a standard and a sample. The peak of the sample shifted its position and changed its intensity due to a different amount of Fe<sup>3+</sup>/FeT. Three coloured, dashed, vertical measurement positions (Pos) (<span class="math inline">\(\rightarrow\)</span> L-values) are indicated.
</figcaption>
</figure>
</div>
<p>The maximum counts difference between the two spectra can be identified when the counts of spectra, e.g., almandine are subtracted from the counts of the other spectra, which would then be andradite. The positions of the maxima and minima of the resulting <em>difference spectra</em> (orange line in <a href="#fig-fe-spectra-alm-and" class="quarto-xref">Figure&nbsp;4</a>) indicate the positions, where the two spectra have their maximum counts differences.</p>
<p>The counts differences between a single, e.g., FeLa standard and sample would insufficiently sensitive to correlate these with Fe<sup>3+</sup>/FeT difference between the standard and the sample. Therefore the counts differences between both, the FeLa and FeLb are determined. To obtain maximum changes in counts, for FeLa the position is chosen, where the difference spectra has its maxima, which will decrease with changing Fe<sup>3+</sup>/FeT, while for FeLb the position is chosen, where the difference spectra has its minima, which will increase with changing Fe<sup>3+</sup>/FeT. The change of counts at these two positions is then expressed by dividing the counts at these two positions, specifically by dividing the counts at the FeLb flank through the counts of the FeLa flank, in short: FeLb/FeLa. This provides a dimensionless number, which is preferable instead of the counts difference, which would be a dimensional number, and depend on measurement conditions.</p>
<p>The two analyser crystal positions should not be too close to their respective peaks, i.e., good analyser crystal positions in case of <a href="#fig-fe-spectra-alm-and" class="quarto-xref">Figure&nbsp;4</a> would be at 188.07 mm for FeLb and at 190.67 for FeLa, as drawn in the figure by the dashed, grey, vertical lines.</p>
<div id="fig-fe-spectra-alm-and" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe-spectra-alm-and-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-spectra-alm-and.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe-spectra-alm-and-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: FeLa and FeLb spectra for almandine and andradite, and the difference spectra of andradite minus almandine. Dashed, grey, vertical lines indicate ideal measurement positions for the TAPL analyser crystal positions. Measurement conditions are the same as for <a href="#fig-fe-spectra-alm" class="quarto-xref">Figure&nbsp;1</a>.
</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Fe<sup>3+</sup>/FeT-poor (e.g., almandine) and Fe<sup>3+</sup>/FeT-rich (andradite) garnets have different chemical peak shifts. The extent of this chemical peak shift is a function of the garnet’s Fe<sup>3+</sup>/FeT and FeT. Count rates are measured on the FeLa and FeLb flanks and from these the dimensionless FeLb/FeLa-ratio is calculated. This ratio together with the FeT of a granet is used to determine its Fe<sup>3+</sup>/FeT.</p>
</div>
</div>
</div>
</section>
<section id="application" class="level1">
<h1>Application</h1>
<p>The FeLb/FeLa of a garnet not only depends on its Fe<sup>3+</sup>/FeT, but also on its Fe-content. <a href="#fig-fe-parametrisation-method" class="quarto-xref">Figure&nbsp;5</a> illustrates this dependency, with the total Fe on the x/ and the FeLb/FeLa ratio on the y-axis. Standards with an ideally wide range of FeT concentrations are therefore imperative. This parametrisation plot and how it is calculated is explained in the next section.</p>
<p>The spread of the iso-Fe<sup>3+</sup>/FeT lines depends on the chosen standards. If only Fe<sup>3+</sup>/FeT-poor garnets are chosen (<a href="#fig-fe-parametrisation-alm" class="quarto-xref">Figure&nbsp;5 (a)</a>), the spread is large, and the resolution, i.e., the precision of the Fe<sup>3+</sup>/FeT becomes better. The addition of an andradite standard decreases the spread of the iso-Fe<sup>3+</sup>/FeT lines, and reduces the Fe<sup>3+</sup>/FeT resolution (<a href="#fig-fe-parametrisation-alm-and" class="quarto-xref">Figure&nbsp;5 (b)</a>). Finally, the precision of determining the Fe<sup>3+</sup>/FeT becomes increasingly better with increasing FeT, which correlates with a significant increase in the iso-Fe<sup>3+</sup>/FeT lines spread. And vice versa, the lower the FeT in garnet, the more imprecise it becomes to determine its iso-Fe<sup>3+</sup>/FeT.</p>
<div id="fig-fe-parametrisation-method" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe-parametrisation-method-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fe-parametrisation-method" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fe-parametrisation-alm" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fe-parametrisation-alm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-parametrisation-alm.png" class="img-fluid figure-img" data-ref-parent="fig-fe-parametrisation-method">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fe-parametrisation-alm-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Only pyrope-alamandine standards
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-fe-parametrisation-method" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-fe-parametrisation-alm-and" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-fe-parametrisation-alm-and-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-parametrisation-alm-and.png" class="img-fluid figure-img" data-ref-parent="fig-fe-parametrisation-method">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-fe-parametrisation-alm-and-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Almandine and one andradite standard
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe-parametrisation-method-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: The FeLb/FeLa ratio depends on the Fe<sup>3+</sup>/FeT and the FeT concentration of a garnet. The blue and orange lines represent lines of the same Fe<sup>3+</sup>/FeT content, with high FeLb/FeLa represent high Fe<sup>3+</sup>/FeT and vice versa. Standards: large, black-rimmed symbols. Samples: small symbols.
</figcaption>
</figure>
</div>
</section>
<section id="parametrisation" class="level1">
<h1>Parametrisation</h1>
<p><strong>Regression formulas, in which the parameters are used:</strong></p>
<p><span class="math inline">\(Fe^{2+} = A + B \times \frac{L\beta}{L\alpha} + C \times \Sigma Fe + D \times \Sigma Fe \times \frac{L\beta}{L\alpha}\)</span></p>
<p><span class="math inline">\(Fe^{3+} = -A - B \times \frac{L\beta}{L\alpha} - C \times \Sigma Fe - D \times \Sigma Fe \times \frac{L\beta}{L\alpha} + Fe_{tot}\)</span></p>
<p>x = <span class="math inline">\(L\beta/L\alpha\)</span><br>
y = <span class="math inline">\(Fe_{tot}\)</span><br>
z = <span class="math inline">\(Fe^{2+}\)</span></p>
<p>A = [<br>
[n, <span class="math inline">\(\Sigma x\)</span>, <span class="math inline">\(\Sigma y\)</span>, <span class="math inline">\(\Sigma(x \times y)\)</span>],<br>
[<span class="math inline">\(\Sigma x\)</span>, <span class="math inline">\(\Sigma x^2\)</span>, <span class="math inline">\(\Sigma(x \times y)\)</span>, <span class="math inline">\(\Sigma (y \times x^2)\)</span>],<br>
[<span class="math inline">\(\Sigma y\)</span>, <span class="math inline">\(\Sigma(x \times y)\)</span>, <span class="math inline">\(\Sigma(y^2)\)</span>, <span class="math inline">\(\Sigma(x \times y^ 2)\)</span>],<br>
[<span class="math inline">\((x \times y)\)</span>, <span class="math inline">\(\Sigma((x^2) \times y)\)</span>,<br>
<span class="math inline">\(\Sigma(x \times y^2)\)</span>, <span class="math inline">\(\Sigma((x^2) \times (y^2)\)</span>]<br>
]</p>
<p>v = [<span class="math inline">\(z\)</span>, <span class="math inline">\(\Sigma(z \times x)\)</span>, <span class="math inline">\(\Sigma(z \times y)\)</span>, <span class="math inline">\(\Sigma(x \times y \times z)\)</span>]</p>
<p>regression parameters:<br>
rfp = np.linalg.inv(A) @ v</p>
<p>res = rfp[0] + rfp[1] * <span class="math inline">\(L\beta/L\alpha\)</span> + rfp[2] * <span class="math inline">\(Fe_{tot}\)</span> + rfp[3] * (<span class="math inline">\(Fe_{tot}\)</span> * <span class="math inline">\(L\beta/L\alpha\)</span>)</p>
<p>resultsFe3FP = (<span class="math inline">\(Fe_{tot}\)</span> - res)/<span class="math inline">\(Fe_{tot}\)</span></p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The flank method is an elegant, cost efficient high resolution technique to determine Fe<sup>3+</sup>/FeT, and at the same time the chemical composition of the garnet. It has the potential to be used in a wide range of minerals. The main drawback is the tedious effort to setup the flank method for a new mineral type, which requires a range of minerals with variable FeO-concentrations and known Fe<sup>3+</sup>/FeT, as e.g., determined using Mössbauer quadrupole splitting.</p>
</section>
<section id="alternatives" class="level1">
<h1>Alternatives</h1>
<p>Alternative methods to determine Fe<sup>3+</sup>/FeT are <a href="https://en.wikipedia.org/wiki/Mössbauer_spectroscopy">Mössbauer spectroscopy</a> or <a href="https://en.wikipedia.org/wiki/X-ray_absorption_near_edge_structure">XANES (X-ray absorption near edge structure)</a>. Mössbauer spectroscopy has a low resolution in the typical range of tens of µm, while XANES requires a synchrotron and is therefore costly and laborious. These methods can, however, determine Fe<sup>3+</sup>/FeT in basically all types of material.</p>
</section>
<section id="determining-analyser-crystal-positions" class="level1">
<h1>Determining Analyser Crystal Positions</h1>
<p>The flank method requires measurements on the FeLa and FeLb flanks rather than on their respective peaks. The ideal positions of the analyser crystals are best determined using a difference spectra, as described in the previous section. For garnet, this is best produced from a qualitative almandine and and andradite scan. It is, however, not required to record full spectra, as small intervals across the expected minima and maxima of the difference spectra are sufficient. Sufficient step size and dwell time – i.e., the counting time at each step –&nbsp;can be comparatively small, e.g., a step size of 3 µm and a dwell time of 300 ms. <a href="#fig-fe-spectra-segmented" class="quarto-xref">Figure&nbsp;6</a> shows such segmented spectra with an interval for FeLa from 187.5 to 188. 5 mm, and for FeLb from 190 to 191 mm, as well as the resulting difference spectra. A high current of e.g., 300 nA is advisable, to obtain higher count rates. The sole measurement time will then be approx. 7 min, i.e., recording the required spectra should take about <em>10 min</em>, if predefined measurement recipes are used.</p>
<div id="fig-fe-spectra-segmented" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe-spectra-segmented-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-spectra-segmented.png" class="img-fluid figure-img" style="width:50.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe-spectra-segmented-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: A segmented Fe spectra for fast determination of the FeLa and FeLb analyser crystal positions.
</figcaption>
</figure>
</div>
<p>The flank data reduction program has a tool to determine analyser crystal positions (‘Crystal Positioning’ in ‘Tools’). <a href="#fig-fe-spectra-layout-csv-table" class="quarto-xref">Figure&nbsp;7</a> shows how a csv table needs to be prepared for this tool. The ‘Datasets’ section further provides a test dataset for download that also serves as a template.</p>
<div id="fig-fe-spectra-layout-csv-table" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fe-spectra-layout-csv-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/fe-spectra-layout-csv-table.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fe-spectra-layout-csv-table-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Required header row and layout for csv tables to be used with the crystal positioning tool of the data reduction program.
</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Segmented Fe spectra are sufficient to determine analyser crystal positions, e.g., using the one from the Tools section in the data reduction program.</p>
</div>
</div>
</div>
</section>
<section id="epma-set-up" class="level1">
<h1>EPMA Set-Up</h1>
<p>The flank method requires measuring the FeLa, FeLb flanks, as well as the Fe-concentration, e.g., on FeKa. The FeLa and FeLb flank measurement positions need to be input manually, after these have been determined as described above. The flank measurement set-ups in the EPMA measurement program might be labelled with element names that are never or only very rarely used. For the FeLb line, this could be Bi or Br and vor La Ar or As.</p>
<p>The FeLa and FeLb lines can be measured using a TAP-crystal, ideally a large-type TAPL cyrstal for better count rates, as the Fe L-lines are comparatively weak. <a href="#fig-epma-flank-setup" class="quarto-xref">Figure&nbsp;8</a> shows a possible EPMA flank measurement set-up, in which the FeLa and FeLb lines are measured using the TAPL crystal of spectrometer 2 (2TAPL), and redundantly also on 4TAPL, to validate the results obtained with 2TAPL (or vice versa).</p>
<div id="fig-epma-flank-setup" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-epma-flank-setup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/epma-flank-setup.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-epma-flank-setup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: The EPMA-measurement program and set-up for the FeLa and FeLb flanks. The flanks are measured on 2 spectrometers for cross-validation.
</figcaption>
</figure>
</div>
<p>The selected Bi in <a href="#fig-epma-flank-setup" class="quarto-xref">Figure&nbsp;8</a> represents the FeLb flank. The X-ray line as well as the order are as random as the selected Bi for labelling the measurement conditions of the actual FeLb line that is measured with this set-up. The peak position is input manually as determined using e.g., the data reduction program crystal positioning tool. The PHA conditions are determined as usual. The measurement time on all flanks is 100 s. No backgrounds are measured, i.e., the net count rates will be used to determine Fe<sup>3+</sup> abundances.</p>
<p>The remaining spectrometers can be used for normal element analyses. Measuring Fe is mandatory, as it is required to determine Fe<sup>3+</sup> abundances. It is, hence, also mandatory to at least measure all main elements, as these are required for accurate matrix corrected Fe concentrations. As the measurement of the flanks takes a little longer than 200 s (considering movement times of the analyser crystals), there might be time for further elements. <a href="#fig-epma-element-setup" class="quarto-xref">Figure&nbsp;9</a> displays a measurement set-up frequently used at the Institut für Geowissenschaften JEOL EPMA at the Goethe Universität Frankfurt.</p>
<div id="fig-epma-element-setup" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-epma-element-setup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="images/epma-element-setup.png" class="img-fluid figure-img" style="width:40.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-epma-element-setup-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: A full IfG GU Frankfurt EPMA flank measurement set-up.
</figcaption>
</figure>
</div>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Summary
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The FeLa &amp; FeLb measurement set-ups are labelled with fake elements, and measured for cross-validation on two spectrometers using TAPL crystals. Fe and main elements need to be measured for accurate Fe concentrations, further elements can be added.</p>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Hezel2000\.github\.io\/mag4\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">

<div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>
<script defer="" src="gdpr/cookieconsent-3.0.1/cookieconsent.umd.js"></script>
<script defer="" src="gdpr/cookieconsent-3.0.1/cookieconsent-init.js"></script>




</body></html>